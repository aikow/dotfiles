#!/usr/bin/env nu

let stats = (
  ls ~/.local/share/nvim/site/pack/core/opt/
  | where type == dir
  | par-each { |it|
      let name = ($it.name | path basename)
      let data = (tokei $it.name --output json | from json)

      {
        name: $name
        total: $data.Total.code
        total_comments: $data.Total.comments
        lua: $data.Lua?.code
        lua_comments: $data.Lua?.comments
        vimscript: $data."Vim Script"?.code
        vim_comments: $data."Vim Script"?.comments
      }
    }
  | sort-by total
)

$stats | table --theme=light --index=false | print

print ''
print $"Total Plugins: ($stats | length)"
print $"Total Lines: ($stats.total | math sum)"
